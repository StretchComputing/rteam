<!DOCTYPE html>
<html class="no-js">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>rTeam - Admin</title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Place favicon.ico and apple-touch-icon(s) in the root directory -->

  <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/main.css">
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <!--[if lt IE 8]>
    <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
  <![endif]-->

  <h1>rTeam Admin!</h1>

  <h2>Create Person</h2>
  <form id="createPerson">
  	<label style="margin-right:5px;">name:</label><input type="text" id="name"><br>
  	<label style="margin-right:5px;">device signature:</label>
  	<input type="text" id="deviceSignature" value="1234567"><br>
  	<label style="margin-right:5px;">voice signature id:</label>
  	<input type="text" id="voiceSignatureId" value="abcdefg"><br>
    <input type="file"><br>
    <input type="hidden" id="base64image">
    <img src="" height="200" alt="Image preview..."><br>
    <button type="submit">Create Person</button>
  </form>

  <h2>Get Token</h2>
  <form id="getToken">
  	<label style="margin-right:5px;">name:</label><input type="text" id="personName"><br>
    <button type="submit">Get Token</button>
  </form>

<script src="//code.jquery.com/jquery-2.1.0.min.js"></script>
<script>
(function () {
  'use strict';

  var createPerson = function (event) {
        event.preventDefault();
        if (!$('#base64image').val()) {
          alert('Please select an image');
          return;
        }
        if (!$('#name').val()) {
          alert('Please enter a name');
          return;
        }

        $.ajax({
          type: 'POST',
          url: '/persons',
          data: {
            name: $('#name').val(),
            base64image: $('#base64image').val(),
            deviceSignature: $('#deviceSignature').val(),
            voiceSignatureId: $('#voiceSignatureId').val()
          },
          success: function (data) {
            console.log(data);
          },
          error: function (jqXHR, status) {
            console.error(jqXHR, status);
          }
        });
      },

      previewFile = function () {
        var $preview = $('img'),
            file = $('#createPerson input[type=file]')[0].files[0],
            reader  = new FileReader();

        reader.onloadend = function () {
          $preview.prop('src', reader.result);
          $('#base64image').val(reader.result);
        };

        if (file) {
          reader.readAsDataURL(file);
        } else {
          $preview.prop('src', '');
        }
      },

      getToken = function () {
        event.preventDefault();
        if (!$('#personName').val()) {
          alert('Please enter a name');
          return;
        }

        $.ajax({
          type: 'GET',
          url: '/persons/token',
          data: {
            name: $('#personName').val(),
            // deviceSignature: $('#deviceSignature').val(),
          },
          success: function (data) {
            console.log(data);
          },
          error: function (jqXHR, status) {
            console.error(jqXHR, status);
          }
        });
      };


  $('#createPerson').on('submit', createPerson);
  $('#createPerson input[type=file]').on('change', previewFile);
  $('#getToken').on('submit', getToken);
}());
</script>
</body>
</html>